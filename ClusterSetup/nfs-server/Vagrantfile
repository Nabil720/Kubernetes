Vagrant.configure("2") do |config|
  config.vm.box = "generic/ubuntu2004"  # Ubuntu 20.04 box that supports libvirt

  config.vm.hostname = "nfs-server"
  config.vm.network "private_network", ip: "192.168.56.50"  # A static IP address

  config.vm.provider :libvirt do |lv|
    lv.memory = 1024  # Memory size in MB (integer)
    lv.cpus = 1       # Optional: number of CPUs
  end

  # Provision script - install NFS server and create export directory
  config.vm.provision "shell", inline: <<-SHELL
    sudo apt-get update
    sudo apt-get install -y nfs-kernel-server
    sudo mkdir -p /srv/nfs/kubedata
    sudo chown nobody:nogroup /srv/nfs/kubedata
    sudo chmod 777 /srv/nfs/kubedata

    # Export configuration
    echo "/srv/nfs/kubedata *(rw,sync,no_subtree_check,no_root_squash)" | sudo tee /etc/exports
    sudo exportfs -ra
    sudo systemctl restart nfs-kernel-server
  SHELL
end

